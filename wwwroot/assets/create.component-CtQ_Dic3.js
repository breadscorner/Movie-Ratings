var E=(r,t,e)=>{if(!t.has(r))throw TypeError("Cannot "+e)};var i=(r,t,e)=>(E(r,t,"read from private field"),e?e.call(r):t.get(r)),y=(r,t,e)=>{if(t.has(r))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(r):t.set(r,e)},v=(r,t,e,s)=>(E(r,t,"write to private field"),s?s.call(r,e):t.set(r,e),e);var f=(r,t,e)=>(E(r,t,"access private method"),e);import{S as L,s as N,h as R,g as P,n as A,u as U,r as p,j as u}from"./index-EkVBxJ3Y.js";import{s as k}from"./utils-1RRThafF.js";var m,l,a,c,x,C,j,w,K,D=(K=class extends L{constructor(t,e){super();y(this,x);y(this,j);y(this,m,void 0);y(this,l,void 0);y(this,a,void 0);y(this,c,void 0);v(this,l,void 0),v(this,m,t),this.setOptions(e),this.bindMethods(),f(this,x,C).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(t){var s;const e=this.options;this.options=i(this,m).defaultMutationOptions(t),N(e,this.options)||i(this,m).getMutationCache().notify({type:"observerOptionsUpdated",mutation:i(this,a),observer:this}),(s=i(this,a))==null||s.setOptions(this.options),e!=null&&e.mutationKey&&this.options.mutationKey&&R(e.mutationKey)!==R(this.options.mutationKey)&&this.reset()}onUnsubscribe(){var t;this.hasListeners()||(t=i(this,a))==null||t.removeObserver(this)}onMutationUpdate(t){f(this,x,C).call(this),f(this,j,w).call(this,t)}getCurrentResult(){return i(this,l)}reset(){var t;(t=i(this,a))==null||t.removeObserver(this),v(this,a,void 0),f(this,x,C).call(this),f(this,j,w).call(this)}mutate(t,e){var s;return v(this,c,e),(s=i(this,a))==null||s.removeObserver(this),v(this,a,i(this,m).getMutationCache().build(i(this,m),this.options)),i(this,a).addObserver(this),i(this,a).execute(t)}},m=new WeakMap,l=new WeakMap,a=new WeakMap,c=new WeakMap,x=new WeakSet,C=function(){var e;const t=((e=i(this,a))==null?void 0:e.state)??P();v(this,l,{...t,isPending:t.status==="pending",isSuccess:t.status==="success",isError:t.status==="error",isIdle:t.status==="idle",mutate:this.mutate,reset:this.reset})},j=new WeakSet,w=function(t){A.batch(()=>{var e,s,o,b,h,g,S,O;if(i(this,c)&&this.hasListeners()){const d=i(this,l).variables,n=i(this,l).context;(t==null?void 0:t.type)==="success"?((s=(e=i(this,c)).onSuccess)==null||s.call(e,t.data,d,n),(b=(o=i(this,c)).onSettled)==null||b.call(o,t.data,null,d,n)):(t==null?void 0:t.type)==="error"&&((g=(h=i(this,c)).onError)==null||g.call(h,t.error,d,n),(O=(S=i(this,c)).onSettled)==null||O.call(S,void 0,t.error,d,n))}this.listeners.forEach(d=>{d(i(this,l))})})},K);function q(r,t){const e=U(t),[s]=p.useState(()=>new D(e,r));p.useEffect(()=>{s.setOptions(r)},[s,r]);const o=p.useSyncExternalStore(p.useCallback(h=>s.subscribe(A.batchCalls(h)),[s]),()=>s.getCurrentResult(),()=>s.getCurrentResult()),b=p.useCallback((h,g)=>{s.mutate(h,g).catch(F)},[s]);if(o.error&&k(s.options.throwOnError,[o.error]))throw o.error;return{...o,mutate:b,mutateAsync:o.mutate}}function F(){}const B=function(){const[t,e]=p.useState(""),[s,o]=p.useState(0),[b,h]=p.useState(0),{error:g,isPending:S,mutateAsync:O}=q({mutationKey:["movies"],mutationFn:async({title:n,year:M,rating:T})=>{const I=await(await fetch("/api/Movies")).json();return(await fetch("/api/movies",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:I.length+1,title:n,year:M,rating:T})})).json()}}),d=async n=>{n.preventDefault();try{await O({id:0,title:t,rating:s,year:b,createdAt:""}),e(""),o(0),h(0)}catch(M){console.error("Error adding movie:",M)}};return u.jsxs("div",{className:"m-4",children:[u.jsx("h1",{className:"text-4xl mb-10",children:"Add Movie"}),u.jsxs("form",{onSubmit:d,children:[u.jsx("input",{type:"text",name:"title",value:t,onChange:n=>e(n.target.value)}),u.jsx("input",{type:"number",name:"rating",placeholder:"rating",value:s,onChange:n=>o(parseInt(n.target.value))}),u.jsx("input",{type:"number",name:"year",placeholder:"year",value:b,onChange:n=>h(parseInt(n.target.value))}),u.jsx("button",{type:"submit",disabled:S,children:"Add Movie"})]}),S&&u.jsx("p",{children:"Loading..."}),g&&u.jsx("p",{children:"Error: try again later"})]})};export{B as component};
